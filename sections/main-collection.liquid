{% paginate collection.products by section.settings.products_per_page %}
{%- assign sort_by = collection.sort_by | default: collection.default_sort_by -%}
<div class="CollectionProductGrid" id="CollectionProductsContainer" data-id="{{section.id}}" data-view="grid-layout-4">
  <div class="container">
    <div class="product-toolbar-box">
      <div class="aside-title">
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16"><g id="Layer_2" data-name="Layer 2"><g id="Layer_1-2" data-name="Layer 1"><path d="M0,1H16V3H0ZM0,7H16V9H0Zm0,6H16v2H0ZM7,0H9V4H7Zm3,6h2v4H10ZM5,12H7v4H5Z"/></g></g></svg>
        <p>Filters</p>
        {% assign active = false %}
        {%- for filter in collection.filters -%}
        {%- for value in filter.active_values -%}
        {% assign active = true  %}
        {% break %}
        {% endfor %}
        {% endfor %}
        {% if active %}
        <a href="{{ collection.url }}?sort_by={{ sort_by }}" class="select-item filter-clean text-primary">Clear All</a>
        {% endif %}
      </div>
      <nav class="toolbox">
        <div class="toolbox-left">
          <div class="filter-total-result">

            <h6>{{collection.title}} - {{ collection.products_count}} {{ collection.products_count | pluralize: 'item', 'items' }}</h6>
          </div>
        </div>
        <div class="toolbox-right">
          <div class="toolbox-item toolbox-layout">
            <a href="javascript:void(0);" data-layout="" data-value="grid-layout-4" class="btn-layout grid-layout-4">
              <svg xmlns="http://www.w3.org/2000/svg" version="1.2" baseProfile="tiny-ps" viewBox="0 0 19 19" width="19" height="19">
                <title>Layer_1-2</title>
                <style>
                  .grid-layout-4 tspan { white-space:pre }
                  .grid-layout-4 .shp0 { fill: #000000 } 
                </style>
                <g id="Layer_1-2">
                  <path id="Shape 1" class="shp0" d="M0 0L4 0L4 4L0 4L0 0Z"/>
                  <path id="Shape 1 copy" class="shp0" d="M5 0L9 0L9 4L5 4L5 0Z"/>
                  <path id="Shape 1 copy 2" class="shp0" d="M10 0L14 0L14 4L10 4L10 0Z"/>
                  <path id="Shape 1 copy 3" class="shp0" d="M15 0L19 0L19 4L15 4L15 0Z"/>
                  <path id="Shape 1 copy 4" class="shp0" d="M0 5L4 5L4 9L0 9L0 5Z"/>
                  <path id="Shape 1 copy 5" class="shp0" d="M5 5L9 5L9 9L5 9L5 5Z"/>
                  <path id="Shape 1 copy 6" class="shp0" d="M10 5L14 5L14 9L10 9L10 5Z"/>
                  <path id="Shape 1 copy 7" class="shp0" d="M15 5L19 5L19 9L15 9L15 5Z"/>
                  <path id="Shape 1 copy 8" class="shp0" d="M0 10L4 10L4 14L0 14L0 10Z"/>
                  <path id="Shape 1 copy 9" class="shp0" d="M5 10L9 10L9 14L5 14L5 10Z"/>
                  <path id="Shape 1 copy 10" class="shp0" d="M10 10L14 10L14 14L10 14L10 10Z"/>
                  <path id="Shape 1 copy 11" class="shp0" d="M15 10L19 10L19 14L15 14L15 10Z"/>
                  <path id="Shape 1 copy 12" class="shp0" d="M0 15L4 15L4 19L0 19L0 15Z"/>
                  <path id="Shape 1 copy 13" class="shp0" d="M5 15L9 15L9 19L5 19L5 15Z"/>
                  <path id="Shape 1 copy 14" class="shp0" d="M10 15L14 15L14 19L10 19L10 15Z"/>
                  <path id="Shape 1 copy 15" class="shp0" d="M15 15L19 15L19 19L15 19L15 15Z"/>
                </g>
              </svg>
            </a>
            <a href="javascript:void(0);" data-layout="" data-value="grid-layout-3" class="btn-layout grid-layout-3">
              <svg xmlns="http://www.w3.org/2000/svg" version="1.2" baseProfile="tiny-ps" viewBox="0 0 19 19" width="19" height="19">
                <title>Layer_2</title>
                <style>
                  .grid-layout-3 tspan { white-space:pre }
                  .grid-layout-3 .shp0 { fill: #000000 } 
                </style>
                <g id="Layer_2">
                  <g id="Layer_1-2">
                    <path id="Layer" class="shp0" d="M0 0L4.99 0L4.99 4.99L0 4.99L0 0Z"/>
                    <path id="Layer" class="shp0" d="M7 0L11.99 0L11.99 4.99L7 4.99L7 0Z"/>
                    <path id="Layer" class="shp0" d="M0 7L4.99 7L4.99 11.99L0 11.99L0 7Z"/>
                    <path id="Layer" class="shp0" d="M7 7L11.99 7L11.99 11.99L7 11.99L7 7Z"/>
                    <path id="Layer" class="shp0" d="M0 14L4.99 14L4.99 18.99L0 18.99L0 14Z"/>
                    <path id="Layer" class="shp0" d="M7 14L11.99 14L11.99 18.99L7 18.99L7 14Z"/>
                    <path id="Layer copy" class="shp0" d="M14 0L18.99 0L18.99 4.99L14 4.99L14 0Z"/>
                    <path id="Layer copy 2" class="shp0" d="M14 7L18.99 7L18.99 11.99L14 11.99L14 7Z"/>
                    <path id="Layer copy 3" class="shp0" d="M14 14L18.99 14L18.99 18.99L14 18.99L14 14Z"/>
                  </g>
                </g>
              </svg>
            </a>
            <a href="javascript:void(0);" data-layout="" data-value="grid-layout-2" class="btn-layout grid-layout-2">
              <svg xmlns="http://www.w3.org/2000/svg" version="1.2" baseProfile="tiny-ps" viewBox="0 0 19 19" width="19" height="19">
                <title>Layer_2</title>
                <style>
                  .grid-layout-2 tspan { white-space:pre }
                  .grid-layout-2 .shp0 { fill: #000000 } 
                </style>
                <g id="Layer_2">
                  <g id="Layer_1-2">
                    <path id="Shape 1" class="shp0" d="M0 0L9 0L9 9L0 9L0 0Z"/>
                    <path id="Shape 1 copy" class="shp0" d="M10 0L19 0L19 9L10 9L10 0Z"/>
                    <path id="Shape 1 copy 2" class="shp0" d="M0 10L9 10L9 19L0 19L0 10Z"/>
                    <path id="Shape 1 copy 3" class="shp0" d="M10 10L19 10L19 19L10 19L10 10Z"/>
                  </g>
                </g>
              </svg>
            </a>
          </div>
          <div class="toolbox-item toolbox-sort select-box">
            <ul class="" id="sort__list">
              {%- for option in collection.sort_options -%}
              <li class="{% if option.value == sort_by %}selected{%- assign sort_name = option.name | escape  -%}{% endif %}" value="{{ option.name | escape }}">
                <input type="radio" name="sort_by" value="{{ option.value | escape }}" data-name="{{ option.name | escape }}" form="CollectionFiltersForm"{% if option.value == sort_by %}checked{% endif %} hidden/>
                {{ option.name | escape }}
              </li>
              {%- endfor -%}
            </ul>
            <span>Sort by:</span>
            <label for="SortBy">{{sort_name}}</label>
          </div>
        </div>
      </nav>
    </div>
    <div class="product-listing-box">
      <aside class="sidebar sidebar-fixed shop-sidebar sticky-sidebar-wrapper">
        {% include 'collection-sidebar' %}
      </aside>
      <div class="product-content main-content">
        <div class="toolbox-item toolbox-layout">
          <div class="filter-actions">
            <div class="select-items">
              {% assign active = 0 %}
              {%- for filter in collection.filters -%}
              {%- for value in filter.active_values -%}
              {% assign active = active | plus:1 %}
              <a class="select-item" href="{{ value.url_to_remove }}">
                {{ value.label | escape }}
                <span class="close">
                  {% render 'icon-cross' %}
                </span>
              </a>
              {%- endfor -%}

              {% if filter.type == "price_range" %}
              {%- if filter.min_value.value != nil or filter.max_value.value != nil -%}                             
              {% assign active = active | plus:1 %}
              <a class="select-item" href="{{ filter.url_to_remove }}">
                {%- if filter.min_value.value -%}{{ filter.min_value.value | money }}{%- else -%}{{ 0 | money }}{%- endif -%}-{%- if filter.max_value.value -%}{{ filter.max_value.value | money }}{%- else -%}{{ filter.range_max | money }}{%- endif -%}
                <span class="close">
                  {% render 'icon-cross' %}
                </span>
              </a>
              {%- endif -%}
              {% endif %}
              {%- endfor -%}
            </div>
          </div>
        </div>
        <div class="product-collection grid-view">
          <div class="products-grid" style="display:block">
            <div class="row product_columns">
              {% for product in collection.products %}
              {% render 'collection-product-grid',product: product %}
              {% endfor %}
            </div>
          </div>
        </div>
        {% if paginate.pages > 1 %}
        {% include 'pagination' %}
        {% endif %}
      </div>
    </div>
  </div>
</div>

{% endpaginate %}

    <div class="similarItemContainer" style="display:none">
        {%- if recommendations.performed -%}
            {%- if recommendations.products_count > 0 -%}
                <ul class="results-base results-similarGrid">
                    {%- for product in recommendations.products -%}
                        {% assign current_variant = product.selected_or_first_available_variant %}
                    <li class="product-base">
                        <a target="_blank" href="{{product.url}}">
                            <div class="product-imageSliderContainer">
                                <picture class="img-responsive" style="width: 100%; height: 100%; display: block;">
                                    <img src="{{product.featured_image | img_url:'500x'}}" class="img-responsive" alt="{{product.title}}" title="{{product.title}}">
                                </picture>
                            </div>
                            <div class="product-productMetaInfo">
                                <div class="product-brand normal-font">{{product.vendor}}</div>
                                <div class="product-product small-size">{{product.title}}</div>
                                <div class="product-price">
                                    {% if current_variant.compare_at_price < current_variant.price %}
                                    <span class="small-size product-price-detail">
                                        <span class="product-discountedPrice">{{current_variant.price | money}}</span>
                                        <span class="product-strike"><del>{{current_variant.compare_at_price}}</del></span>
                                    </span>
                                    <span class="small-size product-discountPercentage">(({{ product.compare_at_price | minus: product.price | times: 100 | divided_by: product.compare_at_price | append: "% OFF"}}))</span>
                                    {% else %}
                                    <span class="small-size product-price-detail">
                                        <span class="product-discountedPrice">{{current_variant.price | money}}</span>
                                    </span>
                                    {% endif %}
                                </div>
                            </div>
                        </a>
                    </li>
                    {%- endfor -%}
                </ul>
            {% else %}
                <div class="SimilarNoResults" style="">

                    <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="49px" height="50px">
                    <image x="0px" y="0px" width="49px" height="50px" xlink:href="data:img/png;base64,iVBORw0KGgoAAAANSUhEUgAAADEAAAAyCAQAAABfAfs5AAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAAAmJLR0QA/4ePzL8AAAAHdElNRQfkARYRMQNLo02IAAADSUlEQVRYw7WXW0hUQRjHf7tbWmoXzZLSQLuTkRYZWg9qmWWXpaALPgUF0UNEPXSnt25ERVgE4UMUGFRvZQUVRJGFaKBRS5rZRYtwTVkr09I9vZzGOXvO2Z096jcv3+z8v+83c/abM3NchLN4FlFIDqkk4gJ+4+cVz6jiE0Ng2ZynGc2y/aCSTcQMJn0m1/lrk36g1VPqLL2Hw/yMmP5/u0NatAA31yxT9dNNj+XIG+aGT+ky9DK4yGrDL3W8wIePNrrxMJ7pZJFJPmMlTRu7uaG2gjTeG+b3iGLclsp0jhMwaHeqAEZTLYV8Z2sE/RzuGh5kcWTEJSmgjjlK6z4mxXxjSnhxsSSuZaLakwX2SnG3wgljeS2EzUxWBgCUS5CV9rJDkmx5VABIoFbEvmWUtSiOFiGqiBIAkEufiN9oLfEKQQ+zHSDgpshQaS24ovaHhbGlIkMXk8zDSTQJgdchwo1P5FhnHpxPuu77eeIQEeS28OebEZl4dL+OgEMEPBVeihmRKvwPjgHQgqZ7Y8yIOOH7B4EI0KN7I82IAesfBOIvfbqnhQ65CQo/TjWfhcXb7Wtw0yr8GYNApIkH1GVGNAl/rqit6C1beB1mhI9O3Z/GTMeIAuG1mAdH8FjszP0OAcl06hmC0nokOyAQPpuzOpLtEhkazEULkMEvIdnhAJDERxF/1E50WbpKZkSNGLh5dTDBTjSLXiErjxKwXjoxj4UTnpOE26MATJKOgi8khpOOk27h/cqQqbyUprY5kjyfP5L8pMLrpMDwcVCmMqcSuqWQRg6GWfhy7kmXAg2N02oL9xogGi2cISek0tPZLm1WuZ2yTuoK6S/jZkjhaTTyjlYCxJLCNOYRbzvFI5xQWckSqUYit178hv4etceVzAWbz5XQ9pxc8qR3g4bGFjUIZHOWaoK2yT9TQan+RiviqzTSRpEqBCCLfdynVczzDx3UUMZaw1cSZNIqQfqM9zGXAiiBZJLwoPGLdptLxAIeSmXSzQYeRLMWNcsTZ4aGRoC8oUdAkeGPb2fhcEBKDJAvZA0HZLGhujpYNRwQr6G4f1Ls/FpjZw34WSN6MXQNPQJq+M0K0asfDgRUEaRQ98tVtp4z20Y+Lp5y9R89MxMHU4TKlQAAAABJRU5ErkJggg=="></image>
                    </svg>

                    <p> Sorry, No results found! </p>
                </div>
            {%- endif -%}
        {%- endif -%}
    </div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/noUiSlider/11.1.0/nouislider.min.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/noUiSlider/11.1.0/nouislider.min.css" />
<script src="{{'collection-filters.js' | asset_url}}" defer="defer" ></script> 
<script>
  (function() {

    $('.mall-slider-handles').each(function () {
      var el = this;
      noUiSlider.create(el, {
        start: [el.dataset.start, el.dataset.end],
        connect: true,
        tooltips: true,
        range: {
          min: [parseFloat(el.dataset.min)],
          max: [parseFloat(el.dataset.max)]
        }
      })
    })
        
})();
</script>
{% schema %}
{
  "name": "t:sections.main-collection.name",
  "class": "collection-grid-section",
  "settings": [
    {
      "type": "range",
      "id": "products_per_page",
      "min": 8,
      "max": 24,
      "step": 4,
      "default": 16,
      "label": "t:sections.main-collection.settings.products_per_page.label"
    },
    {
      "type": "header",
      "content": "t:sections.main-collection.settings.header__1.content"
    },
    {
      "type": "checkbox",
      "id": "enable_filtering",
      "default": true,
      "label": "t:sections.main-collection.settings.enable_filtering.label",
      "info": "t:sections.main-collection.settings.enable_filtering.info"
    },
    {
      "type": "checkbox",
      "id": "enable_sorting",
      "default": true,
      "label": "t:sections.main-collection.settings.enable_sorting.label"
    }
  ]
}
{% endschema %}
