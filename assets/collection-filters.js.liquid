(function () {
    
  function collectionFilters(){  
    
  var section = document.getElementById('CollectionProductsContainer')
  var sectionId = document.getElementById('CollectionProductsContainer').dataset.id;
  const filterForm = document.getElementById('CollectionFiltersForm'); 
    var inputs = filterForm.querySelectorAll('input[type=checkbox]');
    Array.from(inputs).forEach(function(input) {
      input.addEventListener("click", ()=>{	
                             getFilterData(filterForm,input,sectionId)
      });
    });  
  var prices = filterForm.querySelectorAll('input[type=number]');
    Array.from(prices).forEach(function(price) {
      price.addEventListener("change", ()=>{	
                             getFilterData(filterForm,price,sectionId)
      });
    });   
    
  var sortBy = section.querySelectorAll('select[name="sort_by"]');
    Array.from(sortBy).forEach(function(sort) {
      sort.addEventListener("change", ()=>{	
                             
                             getFilterData(filterForm,sort,sectionId);
      });
    });   
}
   function getFilterData(filterForm,input,sectionId){    	
      const formData = new FormData(filterForm);
      var searchParameters = new URLSearchParams(formData).toString();
     const url = window.location.pathname+'?section_id='+sectionId+'&'+searchParameters;
//         var _url = window.location.pathname+'?'+searchParameters;
//      window.location.href=_url;
	fetch(url)
      .then(response => response.text())
      .then((responseText) => {
        const html = responseText;
  		const resultData = new DOMParser().parseFromString(html, 'text/html');
  		var itemResultCount = resultData.getElementsByClassName('filter-total-result');
		document.getElementById('shopify-section-'+sectionId).innerHTML = resultData.getElementById('shopify-section-'+sectionId).innerHTML;
      var _url = window.location.pathname+'?'+searchParameters;
        history.pushState({}, null, _url);
  		collectionFilters();
      });
    }
  collectionFilters();
}());