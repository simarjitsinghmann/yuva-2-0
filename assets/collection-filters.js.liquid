(function () {
  
  var filterForm=document.getElementById('CollectionFiltersForm');  
  var section = document.getElementById('CollectionProductsContainer')
  var sectionId = document.getElementById('CollectionProductsContainer').dataset.id;
  function collectionFilters(){    
    var inputs = filterForm.querySelectorAll('input[type=checkbox]');
    Array.from(inputs).forEach(function(input) {
      input.addEventListener("click", ()=>{	
                             getFilterData(input)
      });
    });  
  var prices = filterForm.querySelectorAll('input[type=number]');
    Array.from(prices).forEach(function(input) {
      input.addEventListener("change", ()=>{	
                             getFilterData(input)
      });
    });   
    
  var sortBy = section.querySelectorAll('select[name="sort_by"]');
    Array.from(sortBy).forEach(function(input) {
      input.addEventListener("change", ()=>{	
                             getFilterData(input);
      });
    });   
}
   function getFilterData(input){    	
      const formData = new FormData(filterForm);
      var searchParameters = new URLSearchParams(formData).toString();
     const url = window.location.pathname+'?section_id='+sectionId+'&'+searchParameters;
fetch(url)
      .then(response => response.text())
      .then((responseText) => {
        const html = responseText;
  		const innerHTML = new DOMParser().parseFromString(html, 'text/html');
  		var itemResultCount = innerHTML.getElementsByClassName('filter-total-result');
        var _url = window.location.pathname+'?'+searchParameters;

        history.pushState({}, null, _url);
  		collectionFilters();
      });
    }
  collectionFilters();
}());